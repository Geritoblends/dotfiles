#!/bin/bash

# Paths
DOTS_DIR="$HOME/nix-dots"
SCHEME_DIR="$DOTS_DIR/config/wal/colorschemes"
LAYOUT_DIR="$DOTS_DIR/layouts"

# --- HELPER FUNCTIONS ---

select_color() {
    ls "$SCHEME_DIR" | grep ".json" | sed 's/.json//' | fuzzel --dmenu --prompt="ðŸŽ¨ Theme: " -l 10
}

select_layout() {
    ls -d "$LAYOUT_DIR"/*/ | xargs -n 1 basename | fuzzel --dmenu --prompt="ðŸ“ Layout: " -l 5
}

# --- MAIN MENU ---

# 1. Ask what to change
MODE=$(echo -e "ðŸŽ¨ Colors Only\nðŸ“ Layout Only\nðŸš€ Both" | fuzzel --dmenu --prompt="Change: " -l 3)

# 2. Handle Selection
case "$MODE" in
    "ðŸŽ¨ Colors Only")
        COLOR=$(select_color)
        if [ -n "$COLOR" ]; then
            theme -c "$COLOR"
        fi
        ;;
        
    "ðŸ“ Layout Only")
        LAYOUT=$(select_layout)
        if [ -n "$LAYOUT" ]; then
            theme -l "$LAYOUT"
        fi
        ;;
        
    "ðŸš€ Both")
        COLOR=$(select_color)
        # If color cancelled, abort everything
        if [ -z "$COLOR" ]; then exit 0; fi
        
        LAYOUT=$(select_layout)
        
        if [ -n "$LAYOUT" ]; then
            theme -c "$COLOR" -l "$LAYOUT"
        else
            # Fallback: User picked color but cancelled layout -> Apply color only
            theme -c "$COLOR"
        fi
        ;;
        
    *)
        exit 0
        ;;
esac
